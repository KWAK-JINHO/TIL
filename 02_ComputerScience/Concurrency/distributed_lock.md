# Distributed Lock

### Distributed Lock 이란?

분산 시스템에서 여러 노드(서버/프로세스)가 공유 자원에 대한 상호 배제(mutual exclusion)를 보장하기 위한 동기화 메커니즘.

### 주요 특징

- 네트워크 지연과 장애를 고려한 설계 필요
- 단일 장애점(SPOF) 회피
- 락 소유자 실패 시 자동 해제 메커니즘 필요

---

## Redis 분산 락

분산 시스템 환경에서 여러 서버가 동시에 공유 자원(캐시, 파일, DB 등)에 접근할 때 사용하는 락. Redis의 원자적 연산을 활용해 구현한다.

### 구현

- SET key value NX PX timeout 명령어를 사용해 키가 없을 때만 원자적으로 락을 획득.
    - NX: 존재하지 않을 때만 설정
    - PX timeout: 자동 만료 시간 설정(데드락 방지)
    - 원자적으로 락 획득과 타임아웃 설정을 동시에 처리
- 락 획득에 성공한 서버만 정상 응답을 받고, 나머지 서버는 실패 처리.
- 비즈니스 로직 수행 후, 락을 획득한 서버가 키 값을 비교한 뒤 본인이 설정한 락일 때만 DEL로 해제.(Lua 활용)
- 타임아웃 기반으로 자동 해제되기 때문에 서버 장애 시에도 영구 락이 남지 않음.