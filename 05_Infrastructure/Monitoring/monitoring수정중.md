# 지표수집과 모니터링

## 지표 수집

지속적인 지표 수집이 필요하다. DataDog, New Relic 등의 외부 서비스를 이용하는 것도 좋다.

## 서비스에서의 지표

- API Call의 수
    - 현재 요청중인 초당 Call 수
    - 실패한 초당 Call 수

- API Latencty
    - 현재 API들의 속도가 Median값, 99% 값, 최대값 등의 지표를 수집

## 서비스 노드의 지표

서버가 죽었는지 알아야 하니까 측정

- 서버의 상태
- CPU사용량(DB 및 API 서버, Cache 서버의 CPU사용량) - 40%, 50%등 어느정도에서는 우리서비스가 문제가 없다는걸 추이를 봐야함
- 메모리 사용량 - 메모리 사용량이 많으면 ->
  레디스의 경우 스왑이 일어날 수 있다. 레디스는 인메모리 데이터 스토어로 설계되어 있어 스왑이 발생하면 성능이 크게 저하된다. 이로 인해 응답 시간 지연, 처리량 감소 등의 문제가 발생할 수 있다. 프로세스 경우는 OOM(out of memory) 이 일어나서 OM killer 가 해당 프로세스를 죽일 수 있다.
- 디스크 사용량: 디스크가 꽉차면 배포가 안되고 로그가 안쌓이는 문제 발생가능성
- 네트워크 사용량(파일, 데이터의 전송량이 얼마나 되는가?): 현재 서버에서 네트워크 사용량이 대부분을 차지하고 있으면, 다른 서버가 작동 안할수도 있고
- 현재 동작중인 정상적인 서버의 수: 물리머신이나 ec2서버는 멀쩡한데 애플리케이션이 작동못하고 있을 수 도 있다.( 다음과 같은 이유로 - 애플리케이션 크래시, 애플리케이션 응답 없음(행), 메모리 누수, 데이터베이스 연결 문제, 의존성 서비스 장애, 애플리케이션 구성 오류)

## 에러의 수집

Sentry를 통한 에러만 전문적으로 수집할 수 있다. 에러가 급감하고 있다던지 배포직후의 새로운 버그는 없는지 모니터링

## AWS 기본적인 지표들

CloudWatch, aws를 사용안하면 자체적인 시스템을 이용하여 수집 influxDB, prometheus를 사용해서 수집

## Alarm

위와 같은 이유들로 해당 임계치를 도달하거나 넘었을경우 알람을 받을 수 있어야 한다. 슬렉, 메신저, 전화같은것으로 장애의 정도에 따라서 알람에 등급을 나눠서 미리 전송해야한다.