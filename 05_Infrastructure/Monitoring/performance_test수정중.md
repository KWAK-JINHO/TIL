# 성능 테스트

보통 성능 테스트 / 부하 테스트 / 스트레스 테스트 이렇게 섞어서 사용한다.

- 어느정도의 성능을 내는지 ( ex) 성능이 1000TPS 정도 된다.)
- 어느 부분에서 어느 정도 부하가 걸리는지를 알아보는 테스트 (Ex) 어느 함수에서 시간이 오래 걸리는지)
- 성능 테스트 / 부하 테스트가 특정 시간 이상 지속적으로 안정적으로 되는지 확인하는 테스트

## 성능 테스트 시에 주의할 점

- 주요 시나리오를 테스트 하는지?: 단순히 API 하나만 호출하는 것이 아니라, 실제 서비스에서 사용되는 패턴으로 테스트가 필요하다.
    - API마다 부하의 종류가 다르다.
    - 여러 API조합이 필요할 수도 있다.

- 클라이언트의 성능 한계를 확인한다.
    - 부하를 주는 클라이언트의 한계로 인해서 성능 측정이 어려울 수 있으므로, 클라이언트를 점점 늘리면서 테스트를 해야한다.

- OS에서 설정하는 값들에 대한 확인: 같은 서버라도 OS 설정에 따라 다를 수 있다.
    - ulimit -a
        - Open Files: 프로세스가 열 수 있는 파일 수 제한으로, 네트워크 소켓도 파일로 취급되므로 특히 웹 서버나 데이터베이스 서버에서 중요합니다
        - Max User Processes: 사용자당 생성 가능한 최대 프로세스 수로, 특히 멀티스레드 애플리케이션에서 중요합니다
    - `/etc/security/limits.conf` 파일을 수정 (시스템에서 사용자나 그룹별로 리소스 제한을 설정할 수 있는 설정)
    - 수정 후 에 기본적으로 재시작 필요

-> AWS ec2는 재시작 하는 것보다는 사용하는 AMI에 기본적인 설정을 해두고 이를 이용하는것이 좋다.

# 서킷 브레이커

api 호출하는걸 계속 실패할때 계속 실패하게 두지 않고 빠르게 pass fail 하게 만들어주는게 circuit Breaker의 역할이다. 웹 서비스의 한 화면을 구성하는 여러가지 API중 하나라도 실패하면 대기시간을 가진다.

정상 호출 시

- 설명을 위해 스레드가 1개라고 가정
- API Timeout 은 300ms 이라고 가정
- 평소에는 20ms 에 처리가 된다고 가정
- 정상 호출시에 1 스레드는 1초에 50개 정도의 API를 처리할 수 있다.

서킷 브레이커, failover, replication, 샤딩, consistnetn Hashing, GUID, 비동기 큐 등 추가학습 예정